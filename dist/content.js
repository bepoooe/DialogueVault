(()=>{"use strict";new class{constructor(){this.sidebar=null,this.promptList=null,this.isVisible=!0,this.prompts=[],this.observer=null,this.debounceTimer=null,this.expandBtn=null,this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.selectedPromptId=null,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.createSidebar(),this.createFloatingExpandBtn(),this.setupObserver(),this.scanForPrompts(),this.setupKeyboardShortcuts(),window.addEventListener("resize",()=>this.handleResize()),this.handleResize();const t=()=>{this.positionExpandBtnDesktop(),this.positionExpandBtnMobile()};window.addEventListener("scroll",t,{passive:!0}),setInterval(t,800)}setupObserver(){this.observer=new MutationObserver(t=>{let e=!1;for(const s of t)if("childList"===s.type&&Array.from(s.addedNodes).some(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;return e.matches("[data-message-author-role]")||e.querySelector("[data-message-author-role]")||e.matches(".group\\/conversation-turn")||e.querySelector(".group\\/conversation-turn")}return!1})){e=!0;break}e&&(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.scanForPrompts()},500))}),this.observer.observe(document.body,{childList:!0,subtree:!0})}scanForPrompts(){const t=["[data-message-author-role]",".group\\/conversation-turn",".group.w-full",'[data-testid*="conversation-turn"]'];let e=[];for(const s of t)if(e=Array.from(document.querySelectorAll(s)),e.length>0)break;if(0===e.length)return console.log("[WayGPT] No conversation messages found"),void this.updatePromptList();console.log(`[WayGPT] Found ${e.length} messages`),this.prompts=[],e.forEach((t,e)=>{try{let s=!1;const n=t.getAttribute("data-message-author-role");if(n)s="user"===n;else{const e=t.querySelector('img[alt*="User"], .relative.p-1.rounded-sm'),n=t.querySelector('[data-testid*="turn"], .markdown, code');s=!(!e||n)}let i="";const o=t.querySelectorAll('div[class*="markdown"], .prose, p, div');for(const t of o){const e=t.textContent?.trim();e&&e.length>i.length&&(i=e)}if(i||(i=t.textContent?.trim()||""),i&&i.length>10){const n=i.length>100?i.substring(0,100)+"...":i;this.prompts.push({id:`turn-${e}`,text:i,isUser:s,element:t,preview:n})}}catch(t){console.error("[WayGPT] Error parsing message:",t)}}),console.log(`[WayGPT] Parsed ${this.prompts.length} conversation items`),this.updatePromptList()}setupKeyboardShortcuts(){document.addEventListener("keydown",t=>{t.ctrlKey&&t.shiftKey&&"I"===t.key&&(t.preventDefault(),this.toggleSidebar())})}updatePromptList(){if(this.promptList){if(this.promptList.innerHTML="",0===this.prompts.length){const t=document.createElement("div");return t.className="empty-state",t.textContent="No conversation yet. Start chatting to see your message index here.",t.style.cssText="\n        text-align: center;\n        padding: 40px 24px;\n        color: #8e8ea0;\n        font-size: 13px;\n        line-height: 1.5;\n      ",void this.promptList.appendChild(t)}this.prompts.forEach(t=>{const e=document.createElement("div");e.className="prompt-item",e.style.cssText="\n        padding: 12px 20px;\n        border-bottom: 1px solid #4d4d4f;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        background: #2f2f2f;\n        margin: 0;\n        position: relative;\n      ";const s=document.createElement("div");s.style.cssText=`\n        position: absolute;\n        left: 0;\n        top: 0;\n        bottom: 0;\n        width: 3px;\n        background: ${t.isUser?"#19c37d":"#ab68ff"};\n      `;const n=document.createElement("div");n.textContent=t.isUser?"You":"ChatGPT",n.style.cssText=`\n        font-size: 11px;\n        color: ${t.isUser?"#19c37d":"#ab68ff"};\n        margin-bottom: 6px;\n        font-weight: 500;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n      `;const i=document.createElement("div");i.textContent=t.preview,i.style.cssText="\n        font-size: 13px;\n        line-height: 1.4;\n        color: #ececec;\n        margin-left: 8px;\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-line-clamp: 3;\n        -webkit-box-orient: vertical;\n      ",e.appendChild(s),e.appendChild(n),e.appendChild(i),e.addEventListener("mouseover",()=>{e.style.backgroundColor="#40414f"}),e.addEventListener("mouseout",()=>{this.selectedPromptId!==t.id&&(e.style.backgroundColor="#2f2f2f")}),e.addEventListener("click",()=>{this.scrollToPrompt(t),this.setSelectedPrompt(t.id,e)}),this.promptList&&this.promptList.appendChild(e)})}}scrollToPrompt(t){t.element.scrollIntoView({behavior:"smooth",block:"center"});const e=t.element.style.backgroundColor,s=t.element.style.transition;t.element.style.backgroundColor="#dbeafe",t.element.style.transition="background-color 0.3s ease",setTimeout(()=>{t.element.style.backgroundColor=e,t.element.style.transition=s},2e3)}setSelectedPrompt(t,e){this.promptList?.querySelectorAll(".prompt-item").forEach(t=>{t.style.backgroundColor="#2f2f2f",t.style.fontWeight=""}),this.selectedPromptId=t,e.style.backgroundColor="#343541",e.style.fontWeight=""}applySelectedStyling(){if(this.selectedPromptId&&this.promptList){const t=Array.from(this.promptList.querySelectorAll(".prompt-item")).find(t=>{const e=Array.from(this.promptList.children).indexOf(t);return this.prompts[e]?.id===this.selectedPromptId});t&&(t.style.backgroundColor="#343541",t.style.fontWeight="")}}handleResize(){this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.isMobile?(this.isVisible=!1,this.sidebar&&(this.sidebar.classList.remove("active"),this.sidebar.classList.add("collapsed"),this.sidebar.style.display="none"),this.positionExpandBtnMobile(),this.showExpandBtn()):(this.isVisible?this.showSidebar():this.hideSidebar(),this.positionExpandBtnDesktop())}createSidebar(){this.sidebar=document.createElement("div"),this.sidebar.id="waygpt-smart-index",this.sidebar.className="waygpt-sidebar",this.sidebar.style.cssText="\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 300px;\n      height: 100vh;\n      background: #212121;\n      border-left: 1px solid #4d4d4f;\n      z-index: 10000;\n      display: flex;\n      flex-direction: column;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n      transition: right 0.3s ease;\n      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);\n    ";const t=document.createElement("div");t.className="sidebar-header",t.style.cssText="\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      border-bottom: 1px solid #4d4d4f;\n      background: #2f2f2f;\n      min-height: 60px;\n    ";const e=document.createElement("h3");e.textContent="Conversation Index",e.className="sidebar-title",e.style.cssText="\n      margin: 0;\n      color: #ececec;\n      font-size: 14px;\n      font-weight: 600;\n      letter-spacing: 0.025em;\n    ";const s=document.createElement("button");s.className="close-btn",s.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M18 6L6 18M6 6l12 12"/>\n      </svg>\n    ',s.title="Close sidebar",s.style.cssText="\n      background: none;\n      border: none;\n      color: #8e8ea0;\n      cursor: pointer;\n      padding: 8px;\n      border-radius: 6px;\n      transition: all 0.15s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 32px;\n      height: 32px;\n    ",s.addEventListener("click",()=>this.hideSidebar()),s.addEventListener("mouseover",()=>{s.style.backgroundColor="#40414f",s.style.color="#ececec"}),s.addEventListener("mouseout",()=>{s.style.backgroundColor="transparent",s.style.color="#8e8ea0"}),t.appendChild(e),t.appendChild(s),this.promptList=document.createElement("div"),this.promptList.className="prompt-list",this.promptList.style.cssText="\n      flex: 1;\n      overflow-y: auto;\n      background: #212121;\n    ";const n=document.createElement("div");n.className="empty-state",n.textContent="No conversation yet. Start chatting to see your message index here.",n.style.cssText="\n      text-align: center;\n      padding: 40px 24px;\n      color: #8e8ea0;\n      font-size: 13px;\n      line-height: 1.5;\n    ",this.promptList.appendChild(n),this.sidebar.appendChild(t),this.sidebar.appendChild(this.promptList),document.body.appendChild(this.sidebar)}createFloatingExpandBtn(){this.expandBtn=document.createElement("button"),this.expandBtn.id="waygpt-sidebar-expand-btn",this.expandBtn.className="floating-expand-btn",this.expandBtn.setAttribute("aria-label","Open conversation index"),this.expandBtn.innerHTML='\n      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n        <path d="M3 12h18M3 6h18M3 18h18"/>\n      </svg>\n    ',this.expandBtn.style.cssText="\n      position: fixed;\n      width: 44px;\n      height: 44px;\n      border-radius: 8px;\n      background: #ffffff;\n      color: #374151;\n      border: 1px solid #d1d5db;\n      cursor: pointer;\n      z-index: 10001;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n      transition: all 0.15s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ",this.expandBtn.addEventListener("click",()=>this.showSidebar()),this.expandBtn.addEventListener("mouseover",()=>{this.expandBtn&&(this.expandBtn.style.backgroundColor="#f9fafb",this.expandBtn.style.borderColor="#9ca3af",this.expandBtn.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")}),this.expandBtn.addEventListener("mouseout",()=>{this.expandBtn&&(this.expandBtn.style.backgroundColor="#ffffff",this.expandBtn.style.borderColor="#d1d5db",this.expandBtn.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)")}),document.body.appendChild(this.expandBtn)}getShareButtonRect(){const t=document.querySelector('button[aria-label*="Share" i]')||document.querySelector('button:has(svg[aria-label*="Share" i])')||Array.from(document.querySelectorAll("button")).find(t=>/share/i.test(t.textContent||""));return t?t.getBoundingClientRect():null}getSearchInputRect(){const t=document.querySelector('input[type="search"]')||document.querySelector('header input[type="text"]')||document.querySelector('form input[type="search"]');return t?t.getBoundingClientRect():null}positionExpandBtnDesktop(){if(this.isMobile||!this.expandBtn)return;const t=this.getShareButtonRect();if(t){const e=10;this.expandBtn.style.position="fixed",this.expandBtn.style.top=Math.max(10,Math.round(t.bottom+e))+"px",this.expandBtn.style.right=Math.max(20,Math.round(window.innerWidth-t.right+8))+"px",this.expandBtn.style.left="",this.expandBtn.style.bottom=""}else this.expandBtn.style.position="fixed",this.expandBtn.style.top="86px",this.expandBtn.style.right="28px",this.expandBtn.style.left="",this.expandBtn.style.bottom="";this.expandBtn.style.display=this.isVisible?"none":"flex"}positionExpandBtnMobile(){if(!this.isMobile||!this.expandBtn)return;const t=this.getSearchInputRect();if(t){const e=Math.max(10,Math.round(t.top-72));this.expandBtn.style.position="fixed",this.expandBtn.style.top=e+"px",this.expandBtn.style.right="16px",this.expandBtn.style.left="",this.expandBtn.style.bottom=""}else this.expandBtn.style.position="fixed",this.expandBtn.style.right="16px",this.expandBtn.style.bottom="36px",this.expandBtn.style.top="",this.expandBtn.style.left="";this.expandBtn.style.display=this.isVisible?"none":"flex"}showExpandBtn(){this.isMobile?this.positionExpandBtnMobile():this.positionExpandBtnDesktop(),this.expandBtn&&(this.expandBtn.style.display=this.isVisible?"none":"flex")}hideExpandBtn(){this.expandBtn&&(this.expandBtn.style.display="none")}showSidebar(){this.isVisible=!0,this.sidebar&&(this.sidebar.classList.add("active"),this.sidebar.classList.remove("collapsed"),this.sidebar.style.display="flex",this.sidebar.style.right="0"),this.hideExpandBtn(),this.isMobile&&this.sidebar&&(this.sidebar.style.width="100%",document.body.style.overflow="hidden"),this.applySelectedStyling()}hideSidebar(){this.isVisible=!1,this.sidebar&&(this.sidebar.classList.remove("active"),this.sidebar.classList.add("collapsed"),this.isMobile?(this.sidebar.style.display="none",document.body.style.overflow=""):this.sidebar.style.right="-300px"),this.isMobile?this.positionExpandBtnMobile():this.positionExpandBtnDesktop(),this.showExpandBtn()}updateLayout(){this.sidebar&&(window.innerWidth,this.isMobile===window.innerWidth>=768&&(this.isMobile=window.innerWidth<768,this.setupResponsiveLayout()))}setupResponsiveLayout(){this.sidebar&&this.expandBtn&&(this.isMobile?(this.sidebar.style.width="100%",this.sidebar.style.height="100%",this.sidebar.style.right=this.isVisible?"0":"-100%"):(this.sidebar.style.width="300px",this.sidebar.style.height="100vh",this.sidebar.style.right=this.isVisible?"0":"-300px"))}toggleSidebar(){this.isVisible?this.hideSidebar():this.showSidebar()}}})();