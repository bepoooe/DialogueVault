(()=>{"use strict";class t{static detectPlatform(){const t=window.location.hostname.toLowerCase();return window.location.href.toLowerCase(),console.log("[DialogueVault] Detecting platform for:",t),t.includes("chat.openai.com")||t.includes("chatgpt.com")?(console.log("[DialogueVault] Detected ChatGPT"),this.configs.chatgpt):t.includes("claude.ai")?(console.log("[DialogueVault] Detected Claude"),this.configs.claude):t.includes("gemini.google.com")||t.includes("bard.google.com")?(console.log("[DialogueVault] Detected Gemini"),this.configs.gemini):(console.log("[DialogueVault] Unsupported platform:",t),this.configs.unknown)}static getConfig(t){return this.configs[t]}}t.configs={chatgpt:{name:"ChatGPT",platform:"chatgpt",messageSelectors:["[data-message-author-role][data-message-id]","[data-message-author-role]:has(.markdown)","[data-message-author-role]:not(:empty)"],userIndicators:['[data-message-author-role="user"]'],assistantIndicators:['[data-message-author-role="assistant"]'],textSelectors:['div[class*="markdown"]',".prose",'div[data-message-text="true"]',"p","div"]},claude:{name:"Claude",platform:"claude",messageSelectors:['[data-testid="message"]',"[data-is-streaming]",'div[class*="font-claude"]',".flex.flex-col.gap-3",".group.relative"],userIndicators:['[data-is-streaming="false"][class*="border"]',".bg-bg-300",'div[class*="user"]'],assistantIndicators:["[data-is-streaming]",".font-claude",'div[class*="assistant"]','svg[class*="claude"]'],textSelectors:[".font-claude-message",".prose","p",'div[class*="text"]',"span"]},gemini:{name:"Gemini",platform:"gemini",messageSelectors:["message-content",".conversation-container .conversation-turn",'[data-test-id*="conversation-turn"]','div[class*="conversation-turn"]',".model-response-text-wrapper",".user-input-text-wrapper","[jsname]"],userIndicators:[".user-input-text-wrapper",'[data-test-id="user-turn"]','div[class*="user"]','[aria-label*="user" i]'],assistantIndicators:[".model-response-text-wrapper",'[data-test-id="model-turn"]','div[class*="model"]','div[class*="response"]','[aria-label*="model" i]'],textSelectors:[".response-container-content",".markdown-content",".message-content",'div[data-message-text="true"]',".text-container","p","div"]},unknown:{name:"Unknown Platform",platform:"unknown",messageSelectors:[".message",'[data-testid*="message"]','[class*="message"]','[class*="chat"]','div[role="log"]'],userIndicators:['[class*="user"]','[data-role="user"]','[data-author="user"]'],assistantIndicators:['[class*="assistant"]','[class*="bot"]','[data-role="assistant"]','[data-author*="assistant"]'],textSelectors:[".text",".content",".markdown","p","div","span"]}};class e{constructor(){this.observer=null,this.updateCallback=null,this.platformConfig=t.detectPlatform(),this.platform=this.platformConfig.platform,console.log(`[DialogueVault] Initialized for ${this.platformConfig.name}`)}debugPageStructure(){console.log("[DialogueVault] === DEBUG PAGE STRUCTURE ==="),console.log("[DialogueVault] Platform:",this.platformConfig.name),console.log("[DialogueVault] URL:",window.location.href),console.log("[DialogueVault] Title:",document.title);const t=document.querySelector("main")||document.body;if(console.log("[DialogueVault] Main element:",t?"found":"not found"),t){console.log("[DialogueVault] Main children count:",t.children.length);const e=t.querySelectorAll("div");console.log("[DialogueVault] Divs in main:",e.length),Array.from(e).filter(t=>(t.textContent?.trim()||"").length>30).slice(0,5).forEach((t,e)=>{const n=t.textContent?.trim().substring(0,100)+"...";console.log(`[DialogueVault] Text div ${e}:`,n),console.log("[DialogueVault] Classes:",t.className),console.log("[DialogueVault] Data attrs:",Array.from(t.attributes).filter(t=>t.name.startsWith("data-")))})}this.platformConfig.messageSelectors.forEach(t=>{const e=document.querySelectorAll(t);console.log(`[DialogueVault] Selector "${t}": ${e.length} elements`)})}startObserving(t){this.updateCallback=t,this.observer=new MutationObserver(t=>{let e=!1;for(const n of t)if("childList"===n.type&&Array.from(n.addedNodes).some(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;return this.platformConfig.messageSelectors.some(t=>e.matches(t)||e.querySelector(t))}return!1})){e=!0;break}e&&setTimeout(()=>{this.updateCallback&&this.updateCallback()},500)});const e=this.platformConfig.containerSelector&&document.querySelector(this.platformConfig.containerSelector)||document.body;this.observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-message-author-role","data-testid","data-role","data-author","data-from"]})}stopObserving(){this.observer&&(this.observer.disconnect(),this.observer=null)}getConversationTurns(){const t=[];console.log(`[DialogueVault] Starting conversation detection for ${this.platformConfig.name}...`),console.log("[DialogueVault] Current URL:",window.location.href);let e=[];for(const t of this.platformConfig.messageSelectors){const n=document.querySelectorAll(t);if(console.log(`[DialogueVault] Selector "${t}" found ${n.length} elements`),n.length>0){let s=Array.from(n).filter(t=>{const e=t.textContent?.trim()||"",n=e.length>20;if("chatgpt"===this.platform){const n=t.hasAttribute("data-message-author-role");if(!n)return!1;if(e.match(/^(What's on your mind today\?|ChatGPT|User|Assistant|Temporary Chat|This chat won't appear|Ask anything|window\._oai_|oai_)$/i))return!1;const s=t.querySelector('div[class*="markdown"]')||t.querySelector(".prose"),o=e.length>50&&!e.includes("Temporary Chat"),i=e.includes("This chat won't appear in history")||e.includes("safety purposes")||e.includes("window._oai_")||e.length<30;return n&&(s||o)&&!i}return n});if("chatgpt"===this.platform&&s.length>0&&(s=s.filter((t,e)=>{const n=s.some((n,s)=>e!==s&&n.contains(t)),o=t.textContent?.trim()||"",i=o.length>30&&!o.includes("What's on your mind")&&!o.includes("window._oai_")&&!o.match(/^(ChatGPT|User|Assistant)$/);return!n&&i})),s.length>0){e=s,console.log(`[DialogueVault] Using ${s.length} valid elements from selector: ${t}`);break}}}if(0===e.length){console.log("[DialogueVault] No elements found with specific selectors, trying general approach...");const t=document.querySelector("main")||document.querySelector('[role="main"]')||document.querySelector(".chat")||document.querySelector('[class*="chat"]')||document.querySelector('[class*="conversation"]')||document.body;if(t){const n=t.querySelectorAll("div");console.log(`[DialogueVault] Found ${n.length} divs in container`),e=Array.from(n).filter(t=>{const e=t.textContent?.trim()||"",n=e.length>50,s=t.children.length>0,o=t.querySelectorAll("div").length<50,i=t.className.toLowerCase().match(/message|chat|conversation|turn|response|prompt/);return n&&s&&o&&(i||e.length>100)}),console.log(`[DialogueVault] Filtered to ${e.length} potential message elements`)}}if(0===e.length)return console.log("[DialogueVault] No conversation elements found at all"),t;const n=new Set,s=new Set,o=new Set;return e.forEach((e,i)=>{const a=e;if(s.has(a))return;const r=this.determineRole(a);if(r){const e=this.extractPreview(a);if(e&&e.length>3){if("chatgpt"===this.platform&&e.match(/^(What's on your mind|ChatGPT|User|Assistant|Temporary|This chat won't|window\._oai|Ask anything)/i))return;const i=e.toLowerCase().trim().substring(0,50),l=e.toLowerCase().trim();if(n.has(i)||o.has(l))return void console.log(`[DialogueVault] Skipping duplicate: "${e.substring(0,30)}..."`);n.add(i),o.add(l),s.add(a),console.log(`[DialogueVault] Turn ${t.length+1}: ${r} - "${e.substring(0,60)}..."`),t.push({index:t.length,type:r,preview:e,element:a})}}}),console.log(`[DialogueVault] Final result: ${t.length} conversation turns found`),t}determineRole(t){console.log(`[DialogueVault] Determining role for element with class: ${t.className}`);for(const e of this.platformConfig.userIndicators)if(t.matches(e)||t.querySelector(e))return console.log(`[DialogueVault] Found user role via selector: ${e}`),"user";for(const e of this.platformConfig.assistantIndicators)if(t.matches(e)||t.querySelector(e))return console.log(`[DialogueVault] Found assistant role via selector: ${e}`),"assistant";let e=t;for(let t=0;t<3&&e;t++){const t=["data-message-author-role","data-role","data-author","data-from","data-testid"];for(const n of t){const t=e.getAttribute(n)?.toLowerCase()||"";if(t.includes("user")||t.includes("human"))return console.log(`[DialogueVault] Found user role via ${n}="${t}"`),"user";if(t.includes("assistant")||t.includes("bot")||t.includes("ai")||t.includes("gpt")||t.includes("claude")||t.includes("gemini"))return console.log(`[DialogueVault] Found assistant role via ${n}="${t}"`),"assistant"}e=e.parentElement}const n=['img[alt*="user" i]','img[alt*="you" i]','[class*="user" i]','[class*="human" i]','div[style*="align-items: flex-end"]','div[style*="justify-content: flex-end"]'];for(const e of n)if(t.querySelector(e))return console.log(`[DialogueVault] Found user indicator via pattern: ${e}`),"user";const s=["svg",'[class*="bot" i]','[class*="ai" i]','[class*="assistant" i]','[class*="gpt" i]','[class*="claude" i]','[class*="gemini" i]','img[alt*="bot" i]','img[alt*="ai" i]',"code","pre",".markdown"];for(const e of s)if(t.querySelector(e))return console.log(`[DialogueVault] Found assistant indicator via pattern: ${e}`),"assistant";const o=document.querySelector("main")||document.body;if(o){const e=o.querySelectorAll("div"),n=Array.from(e).filter(t=>(t.textContent?.trim()||"").length>50),s=Array.from(n).findIndex(e=>e===t);if(s>=0){const t=s%2==0?"user":"assistant";return console.log(`[DialogueVault] Using alternating pattern: index ${s} = ${t}`),t}}return console.log("[DialogueVault] Could not determine role, returning null"),null}extractPreview(t){for(const e of this.platformConfig.textSelectors){const n=t.querySelector(e);if(n&&n.textContent){const t=n.textContent.trim();if(t.length>10)return this.truncateText(t,100)}}const e=[".markdown",".prose",'[class*="content"]','[class*="text"]','[class*="message"]',"p","span","div"];for(const n of e){const e=t.querySelector(n);if(e&&e.textContent){const t=e.textContent.trim();if(t.length>10)return this.truncateText(t,100)}}let n=t.textContent?.trim()||"";return n=n.replace(/\s+/g," ").trim(),n.length<3?"Message":this.truncateText(n,100)}truncateText(t,e){return t.length<=e?t:t.substring(0,e-3)+"..."}getPlatformName(){return this.platformConfig.name}}new class{constructor(){this.sidebar=null,this.promptList=null,this.isVisible=!0,this.prompts=[],this.observer=null,this.debounceTimer=null,this.expandBtn=null,this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.selectedPromptId=null,this.navigator=new e,this.platformName=this.navigator.getPlatformName(),console.log(`[DialogueVault] Initializing extension for ${this.platformName}`),this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.createSidebar(),this.createFloatingExpandBtn(),this.setupObserver(),this.scanForPrompts(),this.setupKeyboardShortcuts(),window.addEventListener("resize",()=>this.handleResize()),this.handleResize();const t=()=>{this.positionExpandBtnDesktop(),this.positionExpandBtnMobile()};window.addEventListener("scroll",t,{passive:!0}),setInterval(t,800)}setupObserver(){this.navigator.startObserving(()=>{this.scanForPrompts()})}scanForPrompts(){console.log(`[DialogueVault] Scanning for prompts on ${this.platformName}...`);const t=this.navigator.getConversationTurns();if(0===t.length)return console.log("[DialogueVault] No conversation messages found"),this.prompts=[],void this.updatePromptList();console.log(`[DialogueVault] Found ${t.length} messages`),this.prompts=t.map((t,e)=>({id:`turn-${e}`,text:t.preview,isUser:"user"===t.type,element:t.element,preview:t.preview})),console.log(`[DialogueVault] Parsed ${this.prompts.length} conversation items`),this.updatePromptList()}setupKeyboardShortcuts(){document.addEventListener("keydown",t=>{t.ctrlKey&&t.shiftKey&&"I"===t.key&&(t.preventDefault(),this.toggleSidebar()),t.ctrlKey&&t.shiftKey&&"R"===t.key&&(t.preventDefault(),console.log("[DialogueVault] Keyboard refresh triggered"),this.scanForPrompts())})}updatePromptList(){if(!this.promptList)return;if(this.promptList.innerHTML="",0===this.prompts.length){const t=document.createElement("div");return t.className="empty-state",t.textContent="No conversation detected. Start chatting to see your message index here.",t.style.cssText="\n        text-align: center;\n        padding: 40px 24px;\n        color: #8b7355;\n        font-size: 13px;\n        line-height: 1.5;\n      ",void this.promptList.appendChild(t)}const t=document.createElement("div"),e=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});t.innerHTML=`\n      <div>${this.platformName} Conversation</div>\n      <div style="font-size: 10px; margin-top: 2px; opacity: 0.8;">Updated: ${e}</div>\n    `,t.style.cssText="\n      padding: 12px 20px;\n      color: #8b7355;\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n      border-bottom: 1px solid #e5d6c3;\n      background: #e8dbc9;\n      font-weight: 600;\n    ",this.promptList.appendChild(t),this.prompts.forEach(t=>{const e=document.createElement("div");e.className="prompt-item",e.style.cssText="\n        padding: 16px 20px;\n        border-bottom: 1px solid #e5d6c3;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        background: #ffffff;\n        margin: 0;\n        position: relative;\n        border-radius: 8px;\n        margin: 4px;\n        box-shadow: 0 1px 3px rgba(93, 78, 55, 0.1);\n      ";const n=document.createElement("div");n.style.cssText=`\n        position: absolute;\n        left: 0;\n        top: 0;\n        bottom: 0;\n        width: 4px;\n        background: ${t.isUser?"#d4c4a8":"#d2c2a6"};\n        border-radius: 0 4px 4px 0;\n      `;const s=document.createElement("div");s.textContent=t.isUser?"You":this.getAssistantName(),s.style.cssText=`\n        font-size: 11px;\n        color: ${t.isUser?"#8b7355":"#5d4e37"};\n        margin-bottom: 8px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        padding-left: 12px;\n      `;const o=document.createElement("div");o.textContent=t.preview,o.style.cssText="\n        font-size: 13px;\n        line-height: 1.4;\n        color: #5d4e37;\n        margin-left: 12px;\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-line-clamp: 3;\n        -webkit-box-orient: vertical;\n        line-clamp: 3;\n      ",e.appendChild(n),e.appendChild(s),e.appendChild(o),e.addEventListener("mouseover",()=>{e.style.backgroundColor="#eee3d5",e.style.transform="translateY(-1px)",e.style.boxShadow="0 2px 6px rgba(93, 78, 55, 0.15)"}),e.addEventListener("mouseout",()=>{this.selectedPromptId!==t.id&&(e.style.backgroundColor="#ffffff",e.style.transform="translateY(0)",e.style.boxShadow="0 1px 3px rgba(93, 78, 55, 0.1)")}),e.addEventListener("click",()=>{this.scrollToPrompt(t),this.setSelectedPrompt(t.id,e)}),this.promptList&&this.promptList.appendChild(e)})}getAssistantName(){switch(this.platformName){case"ChatGPT":return"ChatGPT";case"Claude":return"Claude";case"Gemini":return"Gemini";case"DeepSeek":return"DeepSeek";case"Poe":case"LMSYS Chatbot Arena":return"Bot";case"You.com":return"You.com";case"Character.AI":return"Character";case"Mistral":return"Mistral";default:return"Assistant"}}scrollToPrompt(t){t.element.scrollIntoView({behavior:"smooth",block:"center"});const e=t.element.style.backgroundColor,n=t.element.style.transition;t.element.style.backgroundColor="#e8dbc9",t.element.style.transition="background-color 0.3s ease",setTimeout(()=>{t.element.style.backgroundColor=e,t.element.style.transition=n},2e3)}setSelectedPrompt(t,e){this.promptList?.querySelectorAll(".prompt-item").forEach(t=>{t.style.backgroundColor="#ffffff",t.style.transform="translateY(0)",t.style.boxShadow="0 1px 3px rgba(93, 78, 55, 0.1)"}),this.selectedPromptId=t,e.style.backgroundColor="#e8dbc9",e.style.boxShadow="0 2px 8px rgba(93, 78, 55, 0.15)"}applySelectedStyling(){if(this.selectedPromptId&&this.promptList){const t=Array.from(this.promptList.querySelectorAll(".prompt-item")).find(t=>{const e=Array.from(this.promptList.children).indexOf(t)-1;return this.prompts[e]?.id===this.selectedPromptId});t&&(t.style.backgroundColor="#e8dbc9",t.style.boxShadow="0 2px 8px rgba(93, 78, 55, 0.15)")}}handleResize(){this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.isMobile?(this.isVisible=!1,this.sidebar&&(this.sidebar.classList.remove("active"),this.sidebar.classList.add("collapsed"),this.sidebar.style.display="none"),this.positionExpandBtnMobile(),this.showExpandBtn()):(this.isVisible?this.showSidebar():this.hideSidebar(),this.positionExpandBtnDesktop())}createSidebar(){this.sidebar=document.createElement("div"),this.sidebar.id="dialoguevault-navigator",this.sidebar.className="dialoguevault-navigator-sidebar",this.sidebar.style.cssText="\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: 320px;\n      height: 100vh;\n      background: #e6d7c4;\n      border-left: 1px solid #d4c4a8;\n      z-index: 10000;\n      display: flex;\n      flex-direction: column;\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      box-shadow: -2px 0 12px rgba(93, 78, 55, 0.15);\n    ";const t=document.createElement("div");t.className="sidebar-header",t.style.cssText="\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 20px;\n      border-bottom: 1px solid #d4c4a8;\n      background: #e4d5c2;\n      min-height: 60px;\n    ";const e=document.createElement("h3");e.textContent="DialogueVault",e.className="sidebar-title",e.style.cssText="\n      margin: 0;\n      color: #5d4e37;\n      font-size: 16px;\n      font-weight: 600;\n      letter-spacing: 0.025em;\n    ";const n=document.createElement("div");n.style.cssText="\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    ";const s=document.createElement("button");s.className="refresh-btn",s.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <polyline points="23 4 23 10 17 10"></polyline>\n        <polyline points="1 20 1 14 7 14"></polyline>\n        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10M22.99 14A9 9 0 0 1 8.36 18.36L23 14"></path>\n      </svg>\n    ',s.title="Refresh conversation",s.style.cssText="\n      background: none;\n      border: none;\n      color: #8b7355;\n      cursor: pointer;\n      padding: 8px;\n      border-radius: 8px;\n      transition: all 0.15s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 32px;\n      height: 32px;\n    ",s.addEventListener("click",()=>{console.log("[DialogueVault] Manual refresh triggered"),this.scanForPrompts(),s.style.transform="rotate(180deg)",setTimeout(()=>{s.style.transform="rotate(0deg)"},300)}),s.addEventListener("mouseover",()=>{s.style.backgroundColor="#ddceb9",s.style.color="#5d4e37"}),s.addEventListener("mouseout",()=>{s.style.backgroundColor="transparent",s.style.color="#8b7355"});const o=document.createElement("button");o.className="close-btn",o.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M18 6L6 18M6 6l12 12"/>\n      </svg>\n    ',o.title="Close sidebar",o.style.cssText="\n      background: none;\n      border: none;\n      color: #8b7355;\n      cursor: pointer;\n      padding: 8px;\n      border-radius: 8px;\n      transition: all 0.15s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 32px;\n      height: 32px;\n    ",o.addEventListener("click",()=>this.hideSidebar()),o.addEventListener("mouseover",()=>{o.style.backgroundColor="#ddceb9",o.style.color="#5d4e37"}),o.addEventListener("mouseout",()=>{o.style.backgroundColor="transparent",o.style.color="#8b7355"}),n.appendChild(s),n.appendChild(o),t.appendChild(e),t.appendChild(n),this.promptList=document.createElement("div"),this.promptList.className="prompt-list",this.promptList.style.cssText="\n      flex: 1;\n      overflow-y: auto;\n      background: #e6d7c4;\n      padding: 8px;\n    ";const i=document.createElement("div");i.className="empty-state",i.textContent="No conversation detected. Start chatting to see your message index here.",i.style.cssText="\n      text-align: center;\n      padding: 40px 24px;\n      color: #8b7355;\n      font-size: 13px;\n      line-height: 1.5;\n    ",this.promptList.appendChild(i);const a=document.createElement("div");a.className="sidebar-footer",a.style.cssText="\n      padding: 12px 20px;\n      border-top: 1px solid #d4c4a8;\n      background: #e4d5c2;\n      font-size: 11px;\n      color: #8b7355;\n      text-align: center;\n      line-height: 1.4;\n    ",a.innerHTML='\n      <div>Ctrl+Shift+I to toggle</div>\n      <div style="margin-top: 2px; opacity: 0.8;">Ctrl+Shift+R to refresh</div>\n    ',this.sidebar.appendChild(t),this.sidebar.appendChild(this.promptList),this.sidebar.appendChild(a),document.body.appendChild(this.sidebar)}createFloatingExpandBtn(){this.expandBtn=document.createElement("button"),this.expandBtn.id="dialoguevault-expand-btn",this.expandBtn.className="floating-expand-btn",this.expandBtn.setAttribute("aria-label","Open DialogueVault navigator"),this.expandBtn.innerHTML='\n      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n        <path d="M3 12h18M3 6h18M3 18h18"/>\n      </svg>\n    ',this.expandBtn.style.cssText="\n      position: fixed;\n      width: 48px;\n      height: 48px;\n      border-radius: 12px;\n      background: #e6d7c4;\n      color: #5d4e37;\n      border: 1px solid #d4c4a8;\n      cursor: pointer;\n      z-index: 10001;\n      box-shadow: 0 2px 8px rgba(93, 78, 55, 0.15);\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ",this.expandBtn.addEventListener("click",()=>this.showSidebar()),this.expandBtn.addEventListener("mouseover",()=>{this.expandBtn&&(this.expandBtn.style.backgroundColor="#e4d5c2",this.expandBtn.style.borderColor="#d2c2a6",this.expandBtn.style.boxShadow="0 4px 12px rgba(93, 78, 55, 0.2)",this.expandBtn.style.transform="translateY(-1px)")}),this.expandBtn.addEventListener("mouseout",()=>{this.expandBtn&&(this.expandBtn.style.backgroundColor="#e6d7c4",this.expandBtn.style.borderColor="#d4c4a8",this.expandBtn.style.boxShadow="0 2px 8px rgba(93, 78, 55, 0.15)",this.expandBtn.style.transform="translateY(0)")}),document.body.appendChild(this.expandBtn)}getShareButtonRect(){const t=document.querySelector('button[aria-label*="Share" i]')||document.querySelector('button:has(svg[aria-label*="Share" i])')||Array.from(document.querySelectorAll("button")).find(t=>/share/i.test(t.textContent||""));return t?t.getBoundingClientRect():null}getSearchInputRect(){const t=document.querySelector('input[type="search"]')||document.querySelector('header input[type="text"]')||document.querySelector('form input[type="search"]');return t?t.getBoundingClientRect():null}positionExpandBtnDesktop(){if(this.isMobile||!this.expandBtn)return;const t=this.getShareButtonRect();if(t){const e=10;this.expandBtn.style.position="fixed",this.expandBtn.style.top=Math.max(10,Math.round(t.bottom+e))+"px",this.expandBtn.style.right=Math.max(20,Math.round(window.innerWidth-t.right+8))+"px",this.expandBtn.style.left="",this.expandBtn.style.bottom=""}else this.expandBtn.style.position="fixed",this.expandBtn.style.top="86px",this.expandBtn.style.right="28px",this.expandBtn.style.left="",this.expandBtn.style.bottom="";this.expandBtn.style.display=this.isVisible?"none":"flex"}positionExpandBtnMobile(){if(!this.isMobile||!this.expandBtn)return;const t=this.getSearchInputRect();if(t){const e=Math.max(10,Math.round(t.top-72));this.expandBtn.style.position="fixed",this.expandBtn.style.top=e+"px",this.expandBtn.style.right="16px",this.expandBtn.style.left="",this.expandBtn.style.bottom=""}else this.expandBtn.style.position="fixed",this.expandBtn.style.right="16px",this.expandBtn.style.bottom="36px",this.expandBtn.style.top="",this.expandBtn.style.left="";this.expandBtn.style.display=this.isVisible?"none":"flex"}showExpandBtn(){this.isMobile?this.positionExpandBtnMobile():this.positionExpandBtnDesktop(),this.expandBtn&&(this.expandBtn.style.display=this.isVisible?"none":"flex")}hideExpandBtn(){this.expandBtn&&(this.expandBtn.style.display="none")}showSidebar(){this.isVisible=!0,this.sidebar&&(this.sidebar.classList.add("active"),this.sidebar.classList.remove("collapsed"),this.sidebar.style.display="flex",this.sidebar.style.right="0"),this.hideExpandBtn(),this.isMobile&&this.sidebar&&(this.sidebar.style.width="100%",document.body.style.overflow="hidden"),this.applySelectedStyling()}hideSidebar(){this.isVisible=!1,this.sidebar&&(this.sidebar.classList.remove("active"),this.sidebar.classList.add("collapsed"),this.isMobile?(this.sidebar.style.display="none",document.body.style.overflow=""):this.sidebar.style.right="-300px"),this.isMobile?this.positionExpandBtnMobile():this.positionExpandBtnDesktop(),this.showExpandBtn()}toggleSidebar(){this.isVisible?this.hideSidebar():this.showSidebar()}}})();